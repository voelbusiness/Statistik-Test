<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IU Statistik Masterclass (BSTA01-02)</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #F59E0B; /* IU Orange */
            --secondary-color: #1F2937;
            --background-color: #F9FAFB;
            --surface-color: #FFFFFF;
            --correct-color: #10B981;
            --incorrect-color: #EF4444;
            --confidence-color: #3B82F6;
            --text-color: #374151;
            --border-color: #D1D5DB;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --border-radius: 12px;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 2rem;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color 0.3s;
        }

        .container {
            max-width: 960px;
            margin: auto;
        }

        header {
            text-align: center;
            padding-bottom: 2rem;
            margin-bottom: 2rem;
        }

        h1 {
            color: var(--secondary-color);
            font-weight: 700;
            font-size: 2.8em;
        }
        
        h3 {
            color: var(--secondary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
            margin-top: 0;
        }

        #timer-container {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--surface-color);
            padding: 10px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            font-size: 1.2em;
            font-weight: 700;
            color: var(--primary-color);
            z-index: 1000;
        }
        
        .question-block {
            margin-bottom: 2rem;
            padding: 2rem;
            border-radius: var(--border-radius);
            background-color: var(--surface-color);
            box-shadow: var(--shadow);
            transition: box-shadow 0.3s ease;
        }
        .question-block:hover {
             box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .question-block p {
            font-weight: 500;
            font-size: 1.25em;
            margin-top: 0;
        }
        
        .confidence-slider {
            margin: 1.5rem 0;
        }
        .confidence-slider label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .answer-label {
            display: block;
            margin-bottom: 0.75rem;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .answer-label:hover {
            border-color: var(--primary-color);
            background-color: #FEF3C7;
        }
        
        .explanation {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background-color: #E5E7EB;
            border-left: 5px solid var(--primary-color);
            border-radius: 0 8px 8px 0;
        }

        #submit-btn {
            display: block;
            width: 100%;
            padding: 1.25rem;
            font-size: 1.5em;
            font-weight: bold;
            color: #fff;
            background: var(--primary-color);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        #submit-btn:hover {
            background-color: #FBBF24;
            filter: brightness(1.1);
        }
        #submit-btn:active {
            transform: scale(0.99);
        }

        #results { display: none; }
        
        #results-dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .result-card {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease-in-out forwards;
            opacity: 0;
        }

        .result-card:nth-child(1) { animation-delay: 0.1s; }
        .result-card:nth-child(2) { animation-delay: 0.2s; }
        .result-card:nth-child(3) { animation-delay: 0.3s; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        #badges-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .badge {
            background-color: var(--background-color);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #6B7280;
            transition: all 0.3s ease;
        }
        
        .badge.earned {
            background-color: var(--primary-color);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.5);
        }
        
        #learning-plan ul {
            list-style-type: none;
            padding: 0;
        }
        #learning-plan li {
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        #learning-plan .priority-high { background-color: #FEE2E2; }
        #learning-plan .priority-medium { background-color: #FEF3C7; }
        #learning-plan .priority-low { background-color: #D1FAE5; }


        .correct { background-color: #D1FAE5 !important; border-color: var(--correct-color) !important; font-weight: bold; }
        .incorrect { background-color: #FEE2E2 !important; border-color: var(--incorrect-color) !important; }

        @media (max-width: 768px) {
            #results-dashboard { grid-template-columns: 1fr; }
            body { padding: 1rem; }
            h1 { font-size: 2em; }
        }
    </style>
</head>
<body>

<div class="container">
    <div id="quiz-container">
        <div id="timer-container">Verbleibende Zeit: <span id="time">75:00</span></div>
        <header>
            <h1>IU Statistik Masterclass (BSTA01-02)</h1>
        </header>
        <form id="quiz-form"></form>
        <button id="submit-btn">Pr√ºfung auswerten & Analyse starten</button>
    </div>

    <div id="results" style="display: none;">
        <header>
            <h1>Pers√∂nliche Auswertung</h1>
        </header>
        <div id="results-dashboard">
            <div class="result-card">
                <h3>Wissenslandkarte (Lektionen)</h3>
                <canvas id="skill-chart"></canvas>
            </div>
            <div class="result-card">
                <h3>Leistungs√ºbersicht</h3>
                <p><strong>Gesamtergebnis:</strong> <span id="total-score"></span></p>
                <p><strong>Zeit gebraucht:</strong> <span id="time-taken"></span></p>
                <p><strong>Gef√§hrliches Halbwissen:</strong> <span id="misjudged"></span> Frage(n) falsch, obwohl Sie sich sehr sicher waren.</p>
                <h3>Deine Badges</h3>
                <div id="badges-container"></div>
            </div>
             <div class="result-card" style="grid-column: 1 / -1;">
                <h3>Dein Pers√∂nlicher Lernplan</h3>
                <div id="learning-plan"></div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const quizDurationMinutes = 75;
    
    // =================================================================================
    // DATA LAYER - EXAKT ABGESTIMMT AUF IU LERNSKRIPT BSTA01-02
    // =================================================================================
    const quizData = [
        // Lektion 1: Einf√ºhrung & Grundlagen (7 Fragen)
        { cat: "Lektion 1: Einf√ºhrung & Grundlagen", text: "1. Laut Skript sind Schulnoten (1-6) ein klassisches Beispiel f√ºr welches Skalenniveau?", options: {A:"Nominalskala", B:"Ordinalskala", C:"Verh√§ltnisskala", D:"Intervallskala"}, answer: "B", explanation: "Skript S. 16: Noten haben eine Rangfolge, aber die Abst√§nde sind nicht gleich interpretierbar. Dies ist die Definition der Ordinalskala." },
        { cat: "Lektion 1: Einf√ºhrung & Grundlagen", text: "2. Was ist der Unterschied zwischen einer Grundgesamtheit und einer Stichprobe?", options: {A:"Es gibt keinen Unterschied", B:"Eine Stichprobe ist eine repr√§sentative Teilmenge der Grundgesamtheit", C:"Die Grundgesamtheit ist immer kleiner als die Stichprobe", D:"Die Stichprobe umfasst alle Merkmalstr√§ger"}, answer: "B", explanation: "Skript S. 14: Die Grundgesamtheit umfasst alle Merkmalstr√§ger, die Stichprobe ist eine daraus gezogene Teilmenge." },
        { cat: "Lektion 1: Einf√ºhrung & Grundlagen", text: "3. Eine Untersuchung, bei der Daten nur zu einem Zeitpunkt erhoben werden, nennt man laut Skript...", options: {A:"Paneldesign", B:"Trenddesign", C:"L√§ngsschnittdesign", D:"Querschnittsdesign"}, answer: "D", explanation: "Skript S. 19: Ein Querschnittsdesign erhebt Daten zu einem Zeitpunkt oder innerhalb einer kurzen Zeitspanne." },
        { cat: "Lektion 1: Einf√ºhrung & Grundlagen", text: "4. Welches der folgenden Merkmale ist stetig?", options: {A:"Anzahl der freien Intensivbetten", B:"Postleitzahl", C:"Zufriedenheit (Skala 1-5)", D:"Einzugsgebiet eines Krankenhauses in km"}, answer: "D", explanation: "Skript S. 17: Stetige Merkmale k√∂nnen unendlich viele Werte innerhalb eines Intervalls annehmen, wie z.B. Distanzen." },
        { cat: "Lektion 1: Einf√ºhrung & Grundlagen", text: "5. Welcher Schritt geh√∂rt NICHT zum 'Ablauf statistischer Untersuchungen' laut Skript S. 18-20?", options: {A:"Datensammlung", B:"Datenverarbeitung", C:"Datenanalyse", D:"Ver√∂ffentlichung der Rohdaten"}, answer: "D", explanation: "Skript S. 18ff: Die drei Hauptschritte sind Datensammlung, Datenverarbeitung und Datenanalyse. Eine Ver√∂ffentlichung von Rohdaten ist kein fester Bestandteil des Ablaufs." },
        { cat: "Lektion 1: Einf√ºhrung & Grundlagen", text: "6. Die Temperatur in Grad Celsius ist ... skaliert.", options: {A:"Nominal", B:"Ordinal", C:"Intervall", D:"Verh√§ltnis"}, answer: "C", explanation: "Skript S. 17: Die Celsius-Skala hat gleich gro√üe Abst√§nde, aber keinen nat√ºrlichen Nullpunkt (0¬∞C ist willk√ºrlich), was typisch f√ºr die Intervallskala ist." },
        { cat: "Lektion 1: Einf√ºhrung & Grundlagen", text: "7. Inferenzstatistik besch√§ftigt sich laut Skript prim√§r mit...", options: {A:"der reinen Beschreibung von Daten durch Tabellen und Grafiken", B:"der √úbertragbarkeit von Stichprobenergebnissen auf die Allgemeinheit", C:"der Erforschung von neuen, unbekannten Bereichen", D:"der Sammlung von Prim√§rdaten"}, answer: "B", explanation: "Skript S. 20: Die Inferenzstatistik pr√ºft, ob deskriptive Ergebnisse einer Stichprobe auf die Grundgesamtheit verallgemeinert werden k√∂nnen." },
        
        // Lektion 2: Deskriptive Statistik (1D) (8 Fragen)
        { cat: "Lektion 2: Deskriptive Statistik (1D)", text: "8. Bei einer rechtsschiefen Verteilung (z.B. Einkommen) gilt typischerweise:", options: {A:"Mittelwert = Median", B:"Mittelwert > Median", C:"Mittelwert < Median", D:"Modus > Mittelwert"}, answer: "B", explanation: "Skript S. 55: Bei einer rechtsschiefen Verteilung ziehen wenige hohe Werte (Ausrei√üer) den Mittelwert nach rechts, sodass er gr√∂√üer als der Median ist." },
        { cat: "Lektion 2: Deskriptive Statistik (1D)", text: "9. Welches Diagramm wird laut Skript ausschlie√ülich f√ºr kardinal-skalierte stetige Merkmale verwendet?", options: {A:"Balkendiagramm", B:"Kreisdiagramm", C:"Paretodiagramm", D:"Histogramm"}, answer: "D", explanation: "Skript S. 41: Das Histogramm wird f√ºr stetige Merkmale genutzt, da es Daten in Klassen zusammenfasst und die Fl√§che die relative H√§ufigkeit darstellt." },
        { cat: "Lektion 2: Deskriptive Statistik (1D)", text: "10. Der Interquartilsabstand (IQR) ist definiert als...", options: {A:"Maximum - Minimum", B:"x(0.75) - x(0.25)", C:"Der h√§ufigste Wert", D:"Der Durchschnitt aller Werte"}, answer: "B", explanation: "Skript S. 58: Der IQR misst die Streuung der mittleren 50% der Daten und berechnet sich aus der Differenz des oberen und unteren Quartils." },
        { cat: "Lektion 2: Deskriptive Statistik (1D)", text: "11. Was summiert man in einer H√§ufigkeitstabelle f√ºr die 'kumulierten H√§ufigkeiten'?", options: {A:"Die absoluten H√§ufigkeiten", B:"Die relativen H√§ufigkeiten", C:"Die Klassenmitten", D:"Die Dichten"}, answer: "B", explanation: "Skript S. 30: Die kumulierte H√§ufigkeit Fm summiert die relativen H√§ufigkeiten fj von der ersten bis zur m-ten Auspr√§gung auf." },
        { cat: "Lektion 2: Deskriptive Statistik (1D)", text: "12. Der Modus (Modalwert) ist...", options: {A:"der robusteste Lageparameter", B:"der Wert in der Mitte der geordneten Daten", C:"diejenige Merkmalsauspr√§gung, die am h√§ufigsten vorkommt", D:"nur f√ºr kardinale Daten berechenbar"}, answer: "C", explanation: "Skript S. 44: Der Modus ist als die h√§ufigste Auspr√§gung eines Merkmals definiert und f√ºr alle Skalenniveaus bestimmbar." },
        { cat: "Lektion 2: Deskriptive Statistik (1D)", text: "13. Wenn alle Werte in einem Datensatz 42 sind, was ist die Standardabweichung?", options: {A:"42", B:"1", C:"0", D:"Nicht definierbar"}, answer: "C", explanation: "Skript S. 58ff: Die Standardabweichung misst die Streuung um den Mittelwert. Wenn alle Werte gleich sind, gibt es keine Streuung, also ist sie 0." },
        { cat: "Lektion 2: Deskriptive Statistik (1D)", text: "14. Die Spannweite ist anf√§llig f√ºr...", options: {A:"eine gro√üe Stichprobe", B:"Ausrei√üer", C:"symmetrische Verteilungen", D:"negative Werte"}, answer: "B", explanation: "Skript S. 57: Da die Spannweite nur aus dem Maximum und Minimum berechnet wird, ist sie sehr empfindlich gegen√ºber extremen Werten (Ausrei√üern)." },
        { cat: "Lektion 2: Deskriptive Statistik (1D)", text: "15. Was gibt die Dichte in einem Histogramm an?", options: {A:"Die absolute H√§ufigkeit einer Klasse", B:"Die relative H√§ufigkeit im Verh√§ltnis zur Klassenbreite", C:"Die Gesamtanzahl der Beobachtungen", D:"Den Mittelwert der Klasse"}, answer: "B", explanation: "Skript S. 41: Um die Fl√§chen vergleichbar zu machen, wird die relative H√§ufigkeit durch die Klassenbreite geteilt, was die Dichte ergibt." },

        // Lektion 3: Deskriptive Statistik (2D) (8 Fragen)
        { cat: "Lektion 3: Deskriptive Statistik (2D)", text: "16. Welches Zusammenhangsma√ü wird laut Skript f√ºr zwei nominalskalierte Merkmale verwendet?", options: {A:"Korrelationskoeffizient nach Bravais-Pearson", B:"Rangkorrelationskoeffizient nach Spearman", C:"Korrigierter Kontingenzkoeffizient K*", D:"Interquartilsabstand"}, answer: "C", explanation: "Skript S. 66 & 71: F√ºr den Zusammenhang zweier nominaler Merkmale wird die Kontingenzanalyse durchgef√ºhrt, die im korrigierten Kontingenzkoeffizienten m√ºndet." },
        { cat: "Lektion 3: Deskriptive Statistik (2D)", text: "17. Ein Rangkorrelationskoeffizient nach Spearman von rS = -0.9 deutet auf...", options: {A:"einen starken monoton wachsenden Zusammenhang", B:"fast keinen monotonen Zusammenhang", C:"einen starken monoton fallenden Zusammenhang", D:"einen perfekten linearen Zusammenhang"}, answer: "C", explanation: "Skript S. 82: Werte nahe -1 deuten auf einen starken, gegenl√§ufigen (je mehr X, desto weniger Y) monotonen Zusammenhang hin." },
        { cat: "Lektion 3: Deskriptive Statistik (2D)", text: "18. Was ist die Kernaussage von 'Korrelation impliziert keine Kausalit√§t'?", options: {A:"Eine Korrelation schlie√üt Kausalit√§t aus", B:"Zwei korrelierte Merkmale m√ºssen einen kausalen Zusammenhang haben", C:"Eine Korrelation allein beweist nicht, dass eine Variable die andere verursacht", D:"Kausalit√§t ist ein rein philosophisches Konzept"}, answer: "C", explanation: "Skript S. 96: Eine Korrelation kann auch durch eine dritte, unbeobachtete Variable (Scheinkorrelation) oder durch Zufall entstehen und ist kein Beweis f√ºr einen Ursache-Wirkungs-Zusammenhang." },
        { cat: "Lektion 3: Deskriptive Statistik (2D)", text: "19. Welches Skalenniveau ist mindestens f√ºr den Korrelationskoeffizienten nach Bravais-Pearson erforderlich?", options: {A:"Nominalskala", B:"Ordinalskala", C:"Kardinalskala", D:"Alle Skalenniveaus"}, answer: "C", explanation: "Skript S. 87: Der Korrelationskoeffizient nach Bravais-Pearson misst lineare Zusammenh√§nge und erfordert, dass Abst√§nde und Verh√§ltnisse interpretierbar sind, was nur bei der Kardinalskala gegeben ist." },
        { cat: "Lektion 3: Deskriptive Statistik (2D)", text: "20. Bei der Kontingenzanalyse vergleicht man die beobachteten H√§ufigkeiten (nij) mit...", options: {A:"den Randh√§ufigkeiten", B:"den erwarteten H√§ufigkeiten unter Annahme der Unabh√§ngigkeit (√±ij)", C:"der Gesamtstichprobengr√∂√üe n", D:"dem Chi-Quadrat-Wert"}, answer: "B", explanation: "Skript S. 71: Der Kern der Kontingenzanalyse ist der Vergleich der tats√§chlich beobachteten H√§ufigkeiten mit jenen, die man bei statistischer Unabh√§ngigkeit erwarten w√ºrde." },
        { cat: "Lektion 3: Deskriptive Statistik (2D)", text: "21. Welches Diagramm wird zur Visualisierung des Zusammenhangs zweier kardinalskalierter Merkmale verwendet?", options: {A:"Histogramm", B:"Balkendiagramm", C:"Streudiagramm (Scatterplot)", D:"Boxplot"}, answer: "C", explanation: "Skript S. 84: Ein Streudiagramm stellt die Wertepaare zweier kardinaler Merkmale als Punkte in einem Koordinatensystem dar, um Muster zu erkennen." },
        { cat: "Lektion 3: Deskriptive Statistik (2D)", text: "22. In einer Kontingenztabelle mit I Zeilen und J Spalten, wie wird Kmax berechnet?", options: {A:"I + J", B:"I * J", C:"sqrt((min(I,J) - 1) / min(I,J))", D:"max(I,J) / n"}, answer: "C", explanation: "Skript S. 75: Kmax, der maximale Wert des Kontingenzkoeffizienten, wird mit der Formel basierend auf dem Minimum von Zeilen- (I) und Spaltenanzahl (J) berechnet, um K zu normieren." },
        { cat: "Lektion 3: Deskriptive Statistik (2D)", text: "23. Ein Wert von K* = 0.314 bedeutet laut Skript...", options: {A:"kein Zusammenhang", B:"schwacher Zusammenhang", C:"mittlerer Zusammenhang", D:"starker Zusammenhang"}, answer: "B", explanation: "Skript S. 75: Gem√§√ü der Einteilung im Skript f√§llt ein Wert zwischen 0,2 und 0,4 in die Kategorie 'schwacher Zusammenhang'." },

        // Lektion 4: Lineare Regression (7 Fragen)
        { cat: "Lektion 4: Lineare Regression", text: "24. Was beschreibt der Regressionskoeffizient 'b' in der einfachen linearen Regression?", options: {A:"Den Startpunkt der Geraden auf der y-Achse", B:"Die Ver√§nderung von Y, wenn X um eine Einheit zunimmt", C:"Die St√§rke des linearen Zusammenhangs", D:"Den durchschnittlichen Fehler der Sch√§tzung"}, answer: "B", explanation: "Skript S. 106: Der Regressionskoeffizient (oder Steigung) 'b' gibt an, um wie viele Einheiten sich die abh√§ngige Variable Y √§ndert, wenn sich die unabh√§ngige Variable X um eine Einheit √§ndert." },
        { cat: "Lektion 4: Lineare Regression", text: "25. Das Bestimmtheitsma√ü R¬≤ gibt an...", options: {A:"ob die Korrelation signifikant ist", B:"die Richtung des Zusammenhangs", C:"welcher Anteil der Varianz der abh√§ngigen Variable durch das Modell erkl√§rt wird", D:"die Steigung der Regressionsgerade"}, answer: "C", explanation: "Skript S. 111: R¬≤ ist der quadrierte Korrelationskoeffizient und misst den Anteil der erkl√§rten Streuung an der Gesamtstreuung der abh√§ngigen Variable." },
        { cat: "Lektion 4: Lineare Regression", text: "26. Die Methode der kleinsten Quadrate minimiert...", options: {A:"die Anzahl der Ausrei√üer", B:"die Steigung der Regressionsgerade", C:"die Summe der quadrierten Abweichungen der Punkte von der Geraden", D:"den Korrelationskoeffizienten"}, answer: "C", explanation: "Skript S. 104: Das Ziel der Methode der kleinsten Quadrate ist es, die Regressionsgerade so zu legen, dass die Summe der quadrierten vertikalen Abst√§nde (Residuen) minimal wird." },
        { cat: "Lektion 4: Lineare Regression", text: "27. In der Regressionsanalyse unterscheidet man zwischen...", options: {A:"abh√§ngiger und unabh√§ngiger Variable", B:"diskreter und stetiger Variable", C:"nominaler und ordinaler Variable", D:"qualitativer und quantitativer Variable"}, answer: "A", explanation: "Skript S. 100: Die Regression analysiert den Einfluss einer oder mehrerer unabh√§ngiger Variablen (Pr√§diktoren) auf eine abh√§ngige Variable (Kriterium)." },
        { cat: "Lektion 4: Lineare Regression", text: "28. Ein Bestimmtheitsma√ü von R¬≤ = 0.64 bedeutet, dass...", options: {A:"64% der Vorhersagen falsch sind", B:"die Korrelation 0.64 betr√§gt", C:"die unabh√§ngige Variable zu 64% die abh√§ngige verursacht", D:"64% der Streuung der abh√§ngigen Variable durch das Modell erkl√§rt werden"}, answer: "D", explanation: "Skript S. 111-112: R¬≤ wird als Prozentsatz interpretiert, der den Erkl√§rungsgehalt des Modells f√ºr die Varianz der Y-Variable angibt." },
        { cat: "Lektion 4: Lineare Regression", text: "29. Was ist ein 'Residuum' in der Regressionsanalyse?", options: {A:"Ein Synonym f√ºr den Korrelationskoeffizienten", B:"Die Differenz zwischen beobachtetem und durch die Gerade gesch√§tztem y-Wert", C:"Ein besonders einflussreicher Datenpunkt", D:"Die unabh√§ngige Variable X"}, answer: "B", explanation: "Skript S. 104: Das Residuum ist der Sch√§tzfehler f√ºr eine einzelne Beobachtung, also der vertikale Abstand des Punktes von der Regressionsgerade." },
        { cat: "Lektion 4: Lineare Regression", text: "30. Um die Qualit√§t einer Regressionsgeraden zu beurteilen, nutzt man laut Skript NICHT...", options: {A:"den Korrelationskoeffizienten", B:"das Bestimmtheitsma√ü", C:"den Standardfehler", D:"den Mittelwert der Residuen"}, answer: "D", explanation: "Skript S. 109: Das Skript nennt explizit den Korrelationskoeffizienten, das Bestimmtheitsma√ü und den Standardfehler als die drei Ma√üzahlen zur Qualit√§tsbeurteilung." },

        // Lektion 5: Wahrscheinlichkeitsrechnung (7 Fragen)
        { cat: "Lektion 5: Wahrscheinlichkeitsrechnung", text: "31. Zwei Ereignisse A und B sind disjunkt, wenn...", options: {A:"P(A ‚à© B) = P(A) * P(B)", B:"P(A ‚à™ B) = 1", C:"sie keine gemeinsamen Ergebnisse haben (P(A ‚à© B) = 0)", D:"P(A) = P(B)"}, answer: "C", explanation: "Skript S. 127: Disjunkte (oder unvereinbare) Ereignisse haben keine Schnittmenge, sie k√∂nnen nicht gleichzeitig eintreten." },
        { cat: "Lektion 5: Wahrscheinlichkeitsrechnung", text: "32. Die Wahrscheinlichkeit des Komplement√§rereignisses A' berechnet sich durch:", options: {A:"P(A) / n", B:"1 - P(A)", C:"P(A) * P(A)", D:"1 + P(A)"}, answer: "B", explanation: "Skript S. 132: Die Wahrscheinlichkeit, dass ein Ereignis NICHT eintritt, ist 1 (oder 100%) minus die Wahrscheinlichkeit, dass es eintritt." },
        { cat: "Lektion 5: Wahrscheinlichkeitsrechnung", text: "33. Was beschreibt die Ergebnismenge Œ©?", options: {A:"Nur die g√ºnstigen Ergebnisse", B:"Nur die unm√∂glichen Ergebnisse", C:"Alle m√∂glichen Ergebnisse eines Zufallsexperiments", D:"Die Wahrscheinlichkeit eines Ereignisses"}, answer: "C", explanation: "Skript S. 116: Die Ergebnismenge (oder Ergebnisraum) Œ© fasst alle denkbaren Ausg√§nge eines Zufallsvorgangs zusammen." },
        { cat: "Lektion 5: Wahrscheinlichkeitsrechnung", text: "34. F√ºr zwei nicht-disjunkte Ereignisse A und B gilt die Additionsregel:", options: {A:"P(A‚à™B) = P(A) + P(B)", B:"P(A‚à™B) = P(A) * P(B)", C:"P(A‚à™B) = P(A) + P(B) - P(A‚à©B)", D:"P(A‚à™B) = P(A) - P(B)"}, answer: "C", explanation: "Skript S. 133: Um die Vereinigungsmenge zu berechnen, m√ºssen die Einzelwahrscheinlichkeiten addiert und die doppelt gez√§hlte Schnittmenge subtrahiert werden." },
        { cat: "Lektion 5: Wahrscheinlichkeitsrechnung", text: "35. Wie wird die Wahrscheinlichkeit P(A) nach Laplace (klassisches Verst√§ndnis) definiert?", options: {A:"Anzahl g√ºnstiger F√§lle / Anzahl m√∂glicher F√§lle", B:"Anzahl m√∂glicher F√§lle / Anzahl g√ºnstiger F√§lle", C:"Anzahl Beobachtungen / n", D:"Subjektive Einsch√§tzung"}, answer: "A", explanation: "Skript S. 130: Die Wahrscheinlichkeit ist der Quotient aus der Anzahl der f√ºr das Ereignis A g√ºnstigen Ergebnisse und der Gesamtanzahl aller m√∂glichen Ergebnisse." },
        { cat: "Lektion 5: Wahrscheinlichkeitsrechnung", text: "36. Der Erwartungswert E(X) einer diskreten Zufallsvariable ist...", options: {A:"der h√§ufigste Wert", B:"der Wert in der Mitte", C:"das gewichtete Mittel der m√∂glichen Werte, gewichtet mit ihren Wahrscheinlichkeiten", D:"die Summe aller Wahrscheinlichkeiten"}, answer: "C", explanation: "Skript S. 143: Der Erwartungswert ist das Pendant zum arithmetischen Mittel und berechnet sich als Summe von 'Wert mal Wahrscheinlichkeit'." },
        { cat: "Lektion 5: Wahrscheinlichkeitsrechnung", text: "37. Eine stetige Zufallsvariable...", options: {A:"hat nur abz√§hlbar viele Auspr√§gungen", B:"kann jeden Wert in einem Intervall annehmen", C:"wird durch eine Wahrscheinlichkeitsfunktion beschrieben", D:"hat immer einen Erwartungswert von 0"}, answer: "B", explanation: "Skript S. 145: Im Gegensatz zu diskreten Variablen k√∂nnen stetige Zufallsvariablen √ºberabz√§hlbar unendlich viele Werte annehmen (z.B. Wartezeit, Gr√∂√üe)." },

        // Lektion 6: Spezielle Verteilungen (8 Fragen)
        { cat: "Lektion 6: Spezielle Verteilungen", text: "38. Welches ist der Hauptunterschied zwischen einer binomial- und einer geometrisch verteilten Zufallsvariable?", options: {A:"Die Erfolgswahrscheinlichkeit p ist unterschiedlich", B:"Binomial z√§hlt Erfolge bei n Versuchen, Geometrisch z√§hlt Misserfolge bis zum 1. Erfolg", C:"Die Binomialverteilung ist stetig, die geometrische diskret", D:"Es gibt keinen Unterschied"}, answer: "B", explanation: "Skript S. 153 & 157: Dies ist die zentrale Unterscheidung. Binomialverteilung hat eine feste Anzahl an Versuchen (n), die geometrische Verteilung nicht." },
        { cat: "Lektion 6: Spezielle Verteilungen", text: "39. Die Form einer Normalverteilung wird durch welche beiden Parameter bestimmt?", options: {A:"n und p", B:"Mittelwert Œº und Standardabweichung œÉ", C:"Freiheitsgrade df", D:"Unter- und Obergrenze"}, answer: "B", explanation: "Skript S. 160: Die Lage der Glockenkurve wird durch den Erwartungswert Œº bestimmt, ihre Breite/Streuung durch die Standardabweichung œÉ." },
        { cat: "Lektion 6: Spezielle Verteilungen", text: "40. Was ist der Zweck der z-Standardisierung (Transformation)?", options: {A:"Eine Verteilung in eine Binomialverteilung zu √ºberf√ºhren", B:"Den Mittelwert zu berechnen", C:"Jede Normalverteilung in eine Standardnormalverteilung (Œº=0, œÉ=1) zu √ºberf√ºhren", D:"Die Varianz zu maximieren"}, answer: "C", explanation: "Skript S. 162: Durch die Transformation z = (x-Œº)/œÉ kann man f√ºr jede Normalverteilung Tabellenwerte der Standardnormalverteilung nutzen, um Wahrscheinlichkeiten zu finden." },
        { cat: "Lektion 6: Spezielle Verteilungen", text: "41. Die Gesamtfl√§che unter der Dichtefunktion einer Normalverteilung ist immer...", options: {A:"0", B:"1", C:"abh√§ngig von Œº", D:"unendlich"}, answer: "B", explanation: "Skript S. 162: Die Gesamtfl√§che unter jeder Wahrscheinlichkeitsdichtefunktion muss 1 (oder 100%) betragen, da sie alle m√∂glichen Ergebnisse repr√§sentiert." },
        { cat: "Lektion 6: Spezielle Verteilungen", text: "42. Wof√ºr wird die t-Verteilung laut Skript insbesondere ben√∂tigt?", options: {A:"F√ºr nominalskalierte Daten", B:"Wenn die Varianz der Grundgesamtheit bekannt ist", C:"Wenn die Stichproben klein sind und die Varianz unbekannt ist", D:"Zur Berechnung der Spannweite"}, answer: "C", explanation: "Skript S. 177: Die t-Verteilung ist der Standardnormalverteilung sehr √§hnlich, ber√ºcksichtigt aber √ºber die Freiheitsgrade die zus√§tzliche Unsicherheit durch kleine Stichproben." },
        { cat: "Lektion 6: Spezielle Verteilungen", text: "43. Der Erwartungswert einer binomialverteilten Zufallsvariable X ~ B(n, p) ist:", options: {A:"n * p", B:"n * p * (1-p)", C:"(1-p) / p", D:"p / n"}, answer: "A", explanation: "Skript S. 156: Der erwartete Anzahl an Erfolgen ist einfach die Anzahl der Versuche (n) multipliziert mit der Erfolgswahrscheinlichkeit (p)." },
        { cat: "Lektion 6: Spezielle Verteilungen", text: "44. Wenn n zunimmt, n√§hert sich die t-Verteilung welcher Verteilung an?", options: {A:"Binomialverteilung", B:"Geometrische Verteilung", C:"Gleichverteilung", D:"Standardnormalverteilung"}, answer: "D", explanation: "Skript S. 179: Mit steigendem Stichprobenumfang (und damit Freiheitsgraden) wird der Unterschied zwischen t-Verteilung und Standardnormalverteilung vernachl√§ssigbar klein." },
        { cat: "Lektion 6: Spezielle Verteilungen", text: "45. Wie findet man die Wahrscheinlichkeit P(X ‚â§ x) f√ºr einen negativen z-Wert?", options: {A:"Man liest den Wert direkt aus der Tabelle ab", B:"1 - Œ¶(z)", C:"1 - Œ¶(-z)", D:"Man kann sie nicht berechnen"}, answer: "B", explanation: "Skript S. 166: Da die Tabelle nur positive z-Werte enth√§lt, nutzt man die Symmetrie: Œ¶(-z) = 1 - Œ¶(z)." },

        // Lektion 7: Statistische Sch√§tzverfahren (7 Fragen)
        { cat: "Lektion 7: Statistische Sch√§tzverfahren", text: "46. Was ist der Unterschied zwischen einer Punkt- und einer Intervallsch√§tzung?", options: {A:"Es gibt keinen", B:"Punktsch√§tzung liefert einen einzelnen Wert, Intervallsch√§tzung einen Bereich", C:"Punktsch√§tzung ist genauer", D:"Intervallsch√§tzung gilt nur f√ºr den Mittelwert"}, answer: "B", explanation: "Skript S. 182 & 185: Eine Punktsch√§tzung sch√§tzt einen Parameter (z.B. Œº) durch eine einzige Zahl (z.B. xÃÑ), ein Konfidenzintervall gibt einen Bereich an, in dem der Parameter mit einer bestimmten Wahrscheinlichkeit liegt." },
        { cat: "Lektion 7: Statistische Sch√§tzverfahren", text: "47. Ein 95%-Konfidenzintervall bedeutet, dass...", options: {A:"der wahre Parameter mit 95% Wahrscheinlichkeit im Intervall liegt", B:"wenn wir den Prozess oft wiederholen, 95% der berechneten Intervalle den wahren Parameter enthalten werden", C:"die Nullhypothese zu 95% falsch ist", D:"der Stichprobenmittelwert zu 95% korrekt ist"}, answer: "B", explanation: "Skript S. 185: Dies ist die korrekte frequentistische Interpretation. Es ist eine Aussage √ºber die Zuverl√§ssigkeit der Methode, nicht √ºber ein einzelnes, spezifisches Intervall." },
        { cat: "Lektion 7: Statistische Sch√§tzverfahren", text: "48. Wann verwendet man zur Berechnung eines Konfidenzintervalls f√ºr den Mittelwert ein Quantil der t-Verteilung anstatt der z-Verteilung?", options: {A:"Immer", B:"Wenn die Varianz der Grundgesamtheit bekannt ist", C:"Wenn die Varianz der Grundgesamtheit unbekannt ist", D:"Nie"}, answer: "C", explanation: "Skript S. 188 & 192: Ist die Varianz œÉ¬≤ unbekannt und muss durch die Stichprobenvarianz s¬≤ gesch√§tzt werden, wird die t-Verteilung verwendet, um die zus√§tzliche Unsicherheit zu ber√ºcksichtigen." },
        { cat: "Lektion 7: Statistische Sch√§tzverfahren", text: "49. Ein Sch√§tzer ist 'konsistent', wenn er...", options: {A:"immer den wahren Wert trifft", B:"niemals den wahren Wert trifft", C:"mit zunehmendem Stichprobenumfang dem wahren Wert immer n√§her kommt", D:"einen Erwartungswert von 0 hat"}, answer: "C", explanation: "Skript S. 183: Konsistenz ist eine Eigenschaft von Sch√§tzern, die besagt, dass sie bei gr√∂√üeren Stichproben genauer werden." },
        { cat: "Lektion 7: Statistische Sch√§tzverfahren", text: "50. Wie wirkt sich eine Vergr√∂√üerung des Stichprobenumfangs n auf die Breite eines Konfidenzintervalls aus?", options: {A:"Das Intervall wird breiter", B:"Das Intervall wird schmaler", C:"Es hat keine Auswirkung", D:"Das Intervall verschiebt sich"}, answer: "B", explanation: "Skript S. 194: Ein gr√∂√üeres n verringert den Standardfehler (œÉ/‚àön), was zu einem pr√§ziseren, also schmaleren, Konfidenzintervall f√ºhrt." },
        { cat: "Lektion 7: Statistische Sch√§tzverfahren", text: "51. Der Stichprobenmittelwert xÃÑ ist ein erwartungstreuer Sch√§tzer f√ºr den...", options: {A:"Populationsmedian", B:"Populationsmodus", C:"Populationserwartungswert Œº", D:"Populationsvarianz œÉ¬≤"}, answer: "C", explanation: "Skript S. 183: Erwartungstreue bedeutet, dass der Erwartungswert des Sch√§tzers dem wahren Parameter entspricht. E(xÃÑ) = Œº." },
        { cat: "Lektion 7: Statistische Sch√§tzverfahren", text: "52. Eine Verringerung des Konfidenzniveaus (z.B. von 99% auf 90%) f√ºhrt zu einem...", options: {A:"schmaleren Intervall", B:"breiteren Intervall", C:"identischen Intervall", D:"unendlichen Intervall"}, answer: "A", explanation: "Skript S. 194: Weniger Vertrauen (kleineres Konfidenzniveau) erfordert einen kleineren kritischen Wert (z.B. z=1.645 f√ºr 90% vs z=2.576 f√ºr 99%), was das Intervall schmaler und weniger 'sicher' macht." },

        // Lektion 8: Hypothesentests (8 Fragen)
        { cat: "Lektion 8: Hypothesentests", text: "53. Was besagt die Nullhypothese (H0) typischerweise?", options: {A:"Dass der vermutete Effekt existiert", B:"Dass es keinen Effekt oder keinen Unterschied gibt", C:"Dass die Alternativhypothese wahr ist", D:"Dass ein Fehler gemacht wurde"}, answer: "B", explanation: "Skript S. 199: Die H0 ist die 'konservative' Annahme, die davon ausgeht, dass es keinen Zusammenhang, keinen Unterschied oder keinen Effekt gibt. Man versucht, sie zu widerlegen." },
        { cat: "Lektion 8: Hypothesentests", text: "54. Ein Fehler 1. Art (Œ±-Fehler) tritt auf, wenn man...", options: {A:"die H0 beibeh√§lt, obwohl sie falsch ist", B:"die H0 verwirft, obwohl sie wahr ist", C:"die H1 verwirft, obwohl sie wahr ist", D:"einen Rechenfehler macht"}, answer: "B", explanation: "Skript S. 209: Der Œ±-Fehler ist die f√§lschliche Ablehnung einer wahren Nullhypothese. Man glaubt, einen Effekt gefunden zu haben, der nicht existiert." },
        { cat: "Lektion 8: Hypothesentests", text: "55. Was ist der Unterschied zwischen einem gerichteten und einem ungerichteten Test?", options: {A:"Gerichtete Tests sind immer genauer", B:"Ungerichtete Tests haben keinen Ablehnungsbereich", C:"Ein gerichteter Test pr√ºft eine spezifische Richtung ('gr√∂√üer als' oder 'kleiner als')", D:"Es gibt keinen Unterschied"}, answer: "C", explanation: "Skript S. 202: Ein ungerichteter Test pr√ºft auf 'ungleich', w√§hrend ein gerichteter (einseitiger) Test eine spezifische Vermutung √ºber die Richtung des Effekts testet." },
        { cat: "Lektion 8: Hypothesentests", text: "56. Wann wird die Nullhypothese abgelehnt?", options: {A:"Wenn die Pr√ºfgr√∂√üe kleiner als der kritische Wert ist", B:"Wenn der p-Wert gr√∂√üer als das Signifikanzniveau Œ± ist", C:"Wenn die Pr√ºfgr√∂√üe (im Betrag) gr√∂√üer als der kritische Wert ist", D:"Wenn das Signifikanzniveau 100% betr√§gt"}, answer: "C", explanation: "Skript S. 205: Die Entscheidungsregel besagt, dass die H0 verworfen wird, wenn die berechnete Pr√ºfgr√∂√üe in den Ablehnungsbereich f√§llt, also extremer als der kritische Wert ist." },
        { cat: "Lektion 8: Hypothesentests", text: "57. Das Signifikanzniveau Œ± gibt die Wahrscheinlichkeit an f√ºr...", options: {A:"einen Fehler 2. Art", B:"eine korrekte Entscheidung", C:"einen Fehler 1. Art", D:"die St√§rke des Effekts"}, answer: "C", explanation: "Skript S. 204: Das Signifikanzniveau Œ± ist die vom Forscher festgelegte, maximal akzeptierte Wahrscheinlichkeit f√ºr einen Fehler 1. Art." },
        { cat: "Lektion 8: Hypothesentests", text: "58. Eine 'Ver√§nderungshypothese' ist laut Skript eine spezielle Form der...", options: {A:"Zusammenhangshypothese", B:"Unterschiedshypothese", C:"Lageparameterhypothese", D:"Nullhypothese"}, answer: "B", explanation: "Skript S. 201: Eine Ver√§nderungshypothese ist eine Unterschiedshypothese, die Unterschiede f√ºr dieselbe Gruppe zu verschiedenen Zeitpunkten (z.B. vor/nach einer Therapie) pr√ºft." },
        { cat: "Lektion 8: Hypothesentests", text: "59. Ein Fehler 2. Art (Œ≤-Fehler) bedeutet...", options: {A:"man verwirft eine wahre H0", B:"man beh√§lt eine falsche H0 f√§lschlicherweise bei", C:"man w√§hlt das falsche Œ±", D:"man formuliert die H1 falsch"}, answer: "B", explanation: "Skript S. 209: Der Œ≤-Fehler tritt auf, wenn ein tats√§chlich existierender Effekt aufgrund der Stichprobendaten nicht entdeckt wird. Man beh√§lt die falsche H0 bei." },
        { cat: "Lektion 8: Hypothesentests", text: "60. Wovon h√§ngt es ab, ob man einen z-Test oder einen t-Test f√ºr einen Erwartungswert durchf√ºhrt?", options: {A:"Von der Gr√∂√üe der Stichprobe", B:"Ob die Varianz der Grundgesamtheit bekannt ist oder nicht", C:"Ob der Test gerichtet oder ungerichtet ist", D:"Vom Wert des Mittelwerts"}, answer: "B", explanation: "Skript S. 210 & 219: Dies ist das zentrale Kriterium. Ist œÉ¬≤ bekannt, wird der z-Test verwendet. Ist œÉ¬≤ unbekannt und muss mit s¬≤ gesch√§tzt werden, wird der t-Test verwendet." }

    ].map((q, i) => ({ ...q, id: i + 1 }));

    let timerInterval;
    let timeRemaining = quizDurationMinutes * 60;
    const initialTime = quizDurationMinutes * 60;

    const categories = [...new Set(quizData.map(q => q.cat))];

    // =================================================================================
    // RENDERING LAYER (Emuliert React-Komponenten)
    // =================================================================================

    function renderQuiz() {
        const form = document.getElementById('quiz-form');
        form.innerHTML = '';
        quizData.forEach(q => {
            const questionBlock = document.createElement('div');
            questionBlock.className = 'question-block';
            questionBlock.setAttribute('data-question-id', q.id);

            let optionsHTML = '';
            for (const [key, value] of Object.entries(q.options)) {
                optionsHTML += `
                    <label class="answer-label">
                        <input type="radio" name="q${q.id}" value="${key}"> ${key}) ${value}
                    </label>
                `;
            }

            questionBlock.innerHTML = `
                <p>${q.text}</p>
                <div class="confidence-slider">
                    <label for="c${q.id}">Wie sicher sind Sie sich? (1=geraten, 3=sehr sicher)</label>
                    <input type="range" id="c${q.id}" name="c${q.id}" min="1" max="3" value="2">
                </div>
                ${optionsHTML}
                <div class="explanation" style="display: none;">
                    <strong>Erkl√§rung:</strong> ${q.explanation}
                </div>
            `;
            form.appendChild(questionBlock);
        });
    }

    function renderDashboard(stats) {
        document.getElementById('total-score').textContent = `${stats.score} von ${quizData.length} (${stats.percentage.toFixed(0)}%)`;
        document.getElementById('misjudged').textContent = stats.misjudgedQuestions;
        
        const timeTaken = initialTime - timeRemaining;
        const minutes = Math.floor(timeTaken / 60);
        const seconds = timeTaken % 60;
        document.getElementById('time-taken').textContent = `${minutes} Min, ${seconds} Sek`;
        
        renderBadges(stats);
        renderChart(stats.categoryScores);
        generateLearningPlan(stats.categoryScores);
    }
    
    function renderBadges(stats) {
        const container = document.getElementById('badges-container');
        container.innerHTML = '';
        
        let badges = [];

        // Category Badges
        for (const category in stats.categoryScores) {
            const { correct, total } = stats.categoryScores[category];
            const earned = total > 0 && correct === total;
            badges.push(`<div class="badge ${earned ? 'earned' : ''}" title="${category}">üéì ${category.split(":")[0]}-Profi</div>`);
        }

        // Performance Badges
        if (stats.percentage === 100) {
            badges.push(`<div class="badge earned">üéØ Perfektionist</div>`);
        }
        if (stats.misjudgedQuestions === 0) {
            badges.push(`<div class="badge earned">üßê Selbsteinsicht-Champion</div>`);
        }
        if (timeRemaining > initialTime / 2) {
             badges.push(`<div class="badge earned">‚ö°Ô∏è Blitzdenker</div>`);
        }
        
        container.innerHTML = badges.join('');
    }

    function renderChart(categoryScores) {
        const ctx = document.getElementById('skill-chart').getContext('2d');
        const labels = Object.keys(categoryScores).map(label => label.split(":")[0]); // Nur "Lektion X"
        const data = Object.values(categoryScores).map(cat => {
            return cat.total > 0 ? (cat.correct / cat.total) * 100 : 0;
        });

        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Beherrschung in %',
                    data: data,
                    fill: true,
                    backgroundColor: 'rgba(245, 158, 11, 0.2)',
                    borderColor: 'rgb(245, 158, 11)',
                    pointBackgroundColor: 'rgb(245, 158, 11)',
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                elements: { line: { tension: 0.1 } },
                scales: {
                    r: {
                        angleLines: { display: false },
                        suggestedMin: 0,
                        suggestedMax: 100,
                        ticks: { backdropColor: 'rgba(255, 255, 255, 0.6)'}
                    }
                }
            }
        });
    }

    // =================================================================================
    // LOGIC LAYER (Controller-Funktionen)
    // =================================================================================

    function startTimer() {
        const display = document.querySelector('#time');
        timerInterval = setInterval(() => {
            timeRemaining--;
            const minutes = Math.floor(timeRemaining / 60).toString().padStart(2, '0');
            const seconds = (timeRemaining % 60).toString().padStart(2, '0');
            display.textContent = `${minutes}:${seconds}`;
            if (timeRemaining <= 0) {
                clearInterval(timerInterval);
                alert("Die Zeit ist um! Die Pr√ºfung wird jetzt ausgewertet.");
                evaluateResults();
            }
        }, 1000);
    }

    function evaluateResults() {
        clearInterval(timerInterval);

        let score = 0;
        let misjudgedQuestions = 0;
        
        const categoryScores = categories.reduce((acc, cat) => {
            acc[cat] = { correct: 0, total: 0 };
            return acc;
        }, {});

        quizData.forEach(item => {
            const qBlock = document.querySelector(`[data-question-id="${item.id}"]`);
            const selected = qBlock.querySelector(`input[name="q${item.id}"]:checked`);
            const confidence = qBlock.querySelector(`input[name="c${item.id}"]`).value;
            const explanation = qBlock.querySelector('.explanation');
            const labels = qBlock.querySelectorAll('.answer-label');

            categoryScores[item.cat].total++;

            if (selected) {
                const isCorrect = selected.value === item.answer;
                if (isCorrect) {
                    score++;
                    categoryScores[item.cat].correct++;
                    selected.closest('.answer-label').classList.add('correct');
                } else {
                    selected.closest('.answer-label').classList.add('incorrect');
                    if (confidence === '3') misjudgedQuestions++;
                }
            }
            
            labels.forEach(l => {
                if (l.querySelector('input').value === item.answer) {
                    if (!l.classList.contains('correct')) {
                         l.classList.add('correct');
                    }
                }
            });
            explanation.style.display = 'block';
        });

        const stats = {
            score,
            misjudgedQuestions,
            categoryScores,
            percentage: (score / quizData.length) * 100
        };
        
        showResultsScreen(stats);
    }
    
    function showResultsScreen(stats) {
        document.getElementById('quiz-container').style.display = 'none';
        document.getElementById('results').style.display = 'block';
        renderDashboard(stats);
        window.scrollTo(0, 0);
    }
    
    function generateLearningPlan(categoryScores) {
        const planContainer = document.getElementById('learning-plan');
        let recommendations = [];

        for (const category in categoryScores) {
            const { correct, total } = categoryScores[category];
            if (total > 0) {
                const percentage = (correct / total) * 100;
                recommendations.push({ category, percentage });
            }
        }
        
        recommendations.sort((a, b) => a.percentage - b.percentage);

        let html = '<ul>';
        recommendations.forEach(rec => {
            let priority, priorityClass, message;
            if (rec.percentage < 60) {
                priority = "üî¥ Hohe Priorit√§t:";
                priorityClass = 'priority-high';
                message = "Hier sind grundlegende L√ºcken. Wiederhole diese Lektion im Skript intensiv.";
            } else if (rec.percentage < 85) {
                priority = "üü° Mittlere Priorit√§t:";
                 priorityClass = 'priority-medium';
                 message = "Gutes Fundament, aber einige Unsicherheiten. Schau dir die falschen Fragen genau an.";
            } else {
                priority = "üü¢ Sehr gut:";
                 priorityClass = 'priority-low';
                 message = "Dieses Thema beherrschst du bereits sehr gut. Kurze Wiederholung gen√ºgt.";
            }
            
            html += `<li class="${priorityClass}"><strong>${priority}</strong> ${rec.category} (${rec.percentage.toFixed(0)}%)<br><small>${message}</small></li>`;
        });
        html += '</ul>';
        planContainer.innerHTML = html;
    }

    // =================================================================================
    // INITIALIZATION
    // =================================================================================
    function init() {
        renderQuiz();
        startTimer();
        document.getElementById('submit-btn').addEventListener('click', (e) => {
            e.preventDefault();
            if(confirm('M√∂chten Sie die Pr√ºfung wirklich beenden und auswerten?')) {
                evaluateResults();
            }
        });
    }

    init();
});
</script>

</body>
</html>
